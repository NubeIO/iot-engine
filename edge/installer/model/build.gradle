import org.jooq.meta.jaxb.ForcedType

import com.nubeiot.buildscript.Strings
import com.nubeiot.buildscript.jooq.DB
import com.nubeiot.buildscript.jooq.JooqGenerateTask
import com.nubeiot.buildscript.jooq.JooqGenerateTask.JsonDataType

dependencies {
    compile project(':core:sql')
    compile project(':core:micro')
    compile project.deps.database.h2
}

task jooqGen(type: JooqGenerateTask) {
    packageName = "com.nubeiot.edge.installer.model"
    doFirst {
        enumTypes = project(':core:sql').ext.enumTypes
        dbTypes = project(':core:sql').ext.dbTypes + [
            new ForcedType(userType: "com.nubeiot.edge.installer.model.type.ModuleType", types: DB.TYPES.varchar,
                           expression: Strings.toRegexIgnoreCase("service_type"),
                           converter: "com.nubeiot.edge.installer.model.converter.ModuleTypeConverter")
        ]
        javaTypes = project(':core:sql').ext.javaTypes + [
            new JsonDataType(className: "com.nubeiot.edge.installer.model.type.ModuleType",
                             converter: "%s.type()",
                             parser: "com.nubeiot.edge.installer.model.type.ModuleType.factory((String)%s)",
                             defVal: "com.nubeiot.edge.installer.model.type.ModuleType.getDefault()")
        ]
    }

}
