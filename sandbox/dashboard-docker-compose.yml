version: "2.4"
services:
    mongo:
        image: mongo:${MONGO_VERSION}

    keycloak:
        image: jboss/keycloak:${KEYCLOAK_VERSION}

    backend:
        image: amd64/nube-dashboard-server:${IOT_VERSION}
        ports:
            - ${DASHBOARD_IOT_PORT}:8080
            - ${DASHBOARD_IOT_EVENTBUS_PORT}:5000
            - ${DASHBOARD_IOT_CLUSTER_PORT}:5701
        volumes:
            - dashboad-data:/data
            - ./engine/dashboard-server.json:/app/conf/config.json
            - ./engine/hazelcast.xml:/app/conf/hazelcast.xml
            - ./engine/eventBusKeystore.jks:/app/conf/eventBusKeystore.jks

    frontend:
        image: iot-engine-dashboard-ui:${FRONTEND_VERSION}
        environment:
            USE_DNS: fasle
            BACKEND_SCHEMA: http
            BACKEND_HOST: ${DASHBOARD_IOT_HOST}
            BACKEND_PORT: ${DASHBOARD_IOT_PORT}
            DITTO_SCHEMA: ws
            DITTO_HOST: ${DASHBOARD_IOT_HOST}
            DITTO_PORT: ${DITTO_NGINX_PORT}
            DITTO_USERNAME: sandbox
            DITTO_PASSWORD: 111
            DITTO_POLICY: fasle
        ports:
            - ${DASHBOARD_PORT}:80

    ditto:
        image: nginx:${NGINX_VERSION}

volumes:
    dashboad-data:
        driver: local
